# Mosquitto MQTT Broker Configuration for PlanetPlant
# Production configuration with optional authentication

# Basic Configuration
listener 1883 0.0.0.0
protocol mqtt

# WebSocket Support for web clients
listener 9001 0.0.0.0
protocol websockets

# Security Settings
allow_anonymous true
# Uncomment the following lines to enable authentication:
# allow_anonymous false
# password_file /mosquitto/config/passwd
# acl_file /mosquitto/config/acl

# Logging
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true

# Persistence
persistence true
persistence_location /mosquitto/data/
autosave_interval 1800

# Connection settings
max_connections 100
max_inflight_messages 20
max_queued_messages 1000
max_packet_size 65535

# Client settings  
connection_messages true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Topic-based ACL (commented out, enable with authentication)
# topic read sensor/+/+
# topic write command/+/+

# Client specific settings
persistent_client_expiration 2h

# Bridge configuration (for external MQTT brokers)
# connection bridge-external
# address external-broker.example.com:1883
# bridge_attempt_unsubscribe true
# bridge_protocol_version mqttv311