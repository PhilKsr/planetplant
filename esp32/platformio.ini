[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

# Serial Monitor Configuration
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    time

# Upload Configuration
upload_port = /dev/cu.usbserial-*
upload_speed = 921600

# Build Configuration
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DCONFIG_ARDUHAL_LOG_COLORS
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DMQTT_MAX_PACKET_SIZE=512
    -DARDUINOJSON_ENABLE_PROGMEM=1

# Library Dependencies
lib_deps = 
    # MQTT Communication
    knolleary/PubSubClient@^2.8
    
    # WiFi Manager for Easy Setup
    tzapu/WiFiManager@^2.0.16-rc.2
    
    # JSON Handling
    bblanchon/ArduinoJson@^6.21.3
    
    # Sensor Libraries
    adafruit/DHT sensor library@^1.4.4
    adafruit/Adafruit Unified Sensor@^1.1.9
    
    # Time Handling
    paulstoffregen/Time@^1.6.1
    
    # HTTP Client
    arduino-libraries/ArduinoHttpClient@^0.4.0
    
    # OTA Updates
    arduino-libraries/ArduinoOTA@^1.0.9
    
    # EEPROM for Configuration Storage
    arduino-libraries/EEPROM@^2.0
    
    # Async Web Server (for configuration)
    me-no-dev/ESP Async WebServer@^1.2.3
    me-no-dev/AsyncTCP@^1.1.1

# Board-specific configurations
[env:esp32-wrover-kit]
platform = espressif32
board = esp32-wrover-kit
framework = arduino
build_flags = ${env:esp32dev.build_flags}
lib_deps = ${env:esp32dev.lib_deps}

[env:esp32-c3-devkitm-1]
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino
build_flags = ${env:esp32dev.build_flags}
lib_deps = ${env:esp32dev.lib_deps}

# Development Environment
[env:debug]
platform = espressif32
board = esp32dev
framework = arduino
build_type = debug
build_flags = 
    ${env:esp32dev.build_flags}
    -DDEBUG_ESP_PORT=Serial
    -DDEBUG_ESP_WIFI
    -DDEBUG_ESP_HTTP_CLIENT
lib_deps = ${env:esp32dev.lib_deps}
monitor_filters = 
    esp32_exception_decoder
    time
    log2file

# Production Environment (Optimized)
[env:production]
platform = espressif32
board = esp32dev
framework = arduino
build_flags = 
    -Os
    -DCORE_DEBUG_LEVEL=0
    -DMQTT_MAX_PACKET_SIZE=512
    -DARDUINOJSON_ENABLE_PROGMEM=1
lib_deps = ${env:esp32dev.lib_deps}